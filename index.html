<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Metrics Analyzer Dashboard</title>
  <meta name="description" content="Interactive metrics analytics dashboard built with React and Plotly.js — exploring revenue, growth, and segmentation across domains." />

  <!-- Preconnect for CDN performance -->
  <link rel="preconnect" href="https://cdn.plot.ly" />
  <link rel="preconnect" href="https://unpkg.com" />

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body, #root { width: 100%; height: 100%; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }

    /* Loading screen */
    #loading-screen {
      position: fixed; inset: 0; z-index: 9999;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: #f9fafb; color: #374151;
    }
    #loading-screen .spinner {
      width: 40px; height: 40px; border: 3px solid #e5e7eb;
      border-top-color: #6366f1; border-radius: 50%;
      animation: spin 0.8s linear infinite; margin-bottom: 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #loading-screen p { font-size: 14px; color: #6b7280; }
  </style>
</head>
<body>
  <div id="loading-screen">
    <div class="spinner"></div>
    <p>Loading dashboard...</p>
  </div>
  <div id="root"></div>

  <!-- React 18 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Plotly.js (minified) -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>

  <!-- Numeral.js (number formatting) -->
  <script src="https://unpkg.com/numeral@2.0.6/min/numeral.min.js"></script>

  <!-- PlotlyChart React wrapper component -->
  <script>
    var PlotlyChart = React.forwardRef(function PlotlyChart(props, ref) {
      var data = props.data;
      var layout = props.layout;
      var onLegendClick = props.onLegendClick;

      var containerRef = React.useRef(null);
      var onLegendClickRef = React.useRef(onLegendClick);
      onLegendClickRef.current = onLegendClick;
      var initializedRef = React.useRef(false);

      React.useImperativeHandle(ref, function () {
        return containerRef.current;
      });

      React.useEffect(function () {
        var el = containerRef.current;
        if (!el) return;

        var config = {
          responsive: true,
          displayModeBar: true,
          displaylogo: false,
          modeBarButtonsToRemove: ['lasso2d', 'select2d']
        };

        Plotly.react(el, data, layout, config);

        if (!initializedRef.current) {
          initializedRef.current = true;
          el.on('plotly_legendclick', function (event) {
            if (onLegendClickRef.current) {
              return onLegendClickRef.current(event);
            }
          });
        }
      }, [data, layout]);

      React.useEffect(function () {
        return function () {
          if (containerRef.current) {
            Plotly.purge(containerRef.current);
          }
        };
      }, []);

      return React.createElement('div', {
        ref: containerRef,
        style: { width: '100%', height: '100%' }
      });
    });
  </script>

  <!-- Pre-compiled dashboard app (JSX → JS via esbuild) -->
  <script src="app.js"></script>

  <!-- Mount the app -->
  <script>
    // Simple error boundary to surface errors visibly
    class ErrorBoundary extends React.Component {
      constructor(props) { super(props); this.state = { error: null }; }
      static getDerivedStateFromError(error) { return { error: error }; }
      render() {
        if (this.state.error) {
          return React.createElement('div', { style: { padding: '40px', color: '#dc2626' } },
            React.createElement('h2', null, 'Something went wrong'),
            React.createElement('pre', { style: { whiteSpace: 'pre-wrap', marginTop: '12px', fontSize: '13px' } },
              this.state.error.message + '\n' + this.state.error.stack
            )
          );
        }
        return this.props.children;
      }
    }

    try {
      var root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(
        React.createElement(ErrorBoundary, null,
          React.createElement(render)
        )
      );
      document.getElementById('loading-screen').style.display = 'none';
    } catch (e) {
      document.getElementById('loading-screen').innerHTML =
        '<div style="color:#dc2626;padding:40px"><h2>Failed to mount</h2><pre>' + e.message + '</pre></div>';
    }
  </script>
</body>
</html>
